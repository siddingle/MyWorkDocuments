#Nginx SSL configuration for nexus 


events {
        }
 
http {
 
  proxy_send_timeout        120;
  proxy_read_timeout        300;
  proxy_buffering           off;
  keepalive_timeout         5 5;
  tcp_nodelay               on;
  ssl_certificate /etc/letsencrypt/live/nexus.cloudnativeapps.in/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/nexus.cloudnativeapps.in/privkey.pem;
  #include /etc/letsencrypt/options-ssl-nginx.conf;
  #ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
  client_max_body_size      1G;
 
  server {
     listen 80;
     server_name nexuspoc.mea-emigrate.com;
     return 301 https://nexuspoc.mea-emigrate.com$request_uri;
  }  
  server {
    listen                  443 ssl;
      location ~ ^/(v1|v2)/[^/]+/?[^/]+/blobs/ {
          if ($request_method ~* (POST|PUT|DELETE|PATCH|HEAD) ) {
              rewrite ^/(.*)$ /repository/emigrate-docker-hosted-repo/$1 last;
          }
          rewrite ^/(.*)$ /repository/emigrate-docker-group-repo/$1 last;
      }
 
      location ~ ^/(v1|v2)/ {
          if ($request_method ~* (POST|PUT|DELETE|PATCH) ) {
              rewrite ^/(.*)$ /repository/emigrate-docker-hosted-repo/$1 last;
          }
          rewrite ^/(.*)$ /repository/emigrate-docker-group-repo/$1 last;
      }
 
 
    location / {
      proxy_pass            http://192.168.70.16:8081/;
      proxy_redirect        off;
      proxy_set_header      Host $host;
      proxy_set_header      X-Real-IP $remote_addr;
      proxy_set_header      X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header      X-Forwarded-Host $server_name;
      proxy_set_header      X-Forwarded-Proto $scheme;
    }
  }
}


sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config
setenforce 0
reboot






kubectl create secret docker-registry nexuspoc --docker-server=nexuspoc.mea-emigrate.com --docker-username=docker-admin --docker-password=account@123
    --docker-server=nexuspoc.mea-emigrate.com \
    --docker-username=docker-admin \
    --docker-password=account@123





apiVersion: v1
kind: Pod
metadata:
  name: private-reg
spec:
  containers:
  - name: private-reg-container
    image: nexuspoc.mea-emigrate.com/nginx
  imagePullSecrets:
  - name: nexuspoc	
	
	
	
	
	
	
	
	
	
	

-rw-r-----. 1 root root 2407 Nov 10  2023  ccf4f61237557d79.crt
-rw-r-----. 1 root root 2407 Nov 10  2023  ccf4f61237557d79.pem

-rwxr-xr-x. 1 root root 2411 Feb  6 09:21 784b79f1539e184a.crt
-rwxr-xr-x. 1 root root 2411 Feb  6 09:21 784b79f1539e184a.pem





To generate CSR request 
openssl req -new -newkey rsa:2048 -nodes -keyout nexuspoc.mea-emigrate.com.key -out nexuspoc.mea-emigrate.com.csr






[root@EMA-PoC-Nexus home]# openssl req -new -newkey rsa:2048 -nodes -keyout nexuspoc.mea-emigrate.com.key -out nexuspoc.mea-emigrate.com.csr
.........+.+....................+...+.+........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+......+...+..+...+...+...+.......+............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
.+...+........+...+....+..+...............+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+.....+...+...............+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+.+..+......+.+......+............+..+.+...+..+.......+............+...+...+........+.........+.+...............+......+.....+......+.......+...+............+..+.+.....+............+...+...+.......+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:IN
State or Province Name (full name) []:Delhi
Locality Name (eg, city) [Default City]:Delhi
Organization Name (eg, company) [Default Company Ltd]:trigyn
Organizational Unit Name (eg, section) []:IT
Common Name (eg, your name or your server's hostname) []:*.mea-emigrate.com
Email Address []:symc@trigyn.com

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
[root@EMA-PoC-Nexus home]# ll
total 36
drwx------. 2 root     root     16384 Jan 18 23:38 lost+found
drwx------. 6 meauser  meauser   4096 Jun 10 20:41 meauser
drwx------. 5 nexus    nexus     4096 May 30 14:16 nexus
-rw-r-----. 1 root     root      1050 Jun 11 12:16 nexuspoc.mea-emigrate.com.csr
-rw-------. 1 root     root      1704 Jun 11 12:15 nexuspoc.mea-emigrate.com.key
drwx------. 3 sysadmin sysadmin  4096 Jan 19 00:47 sysadmin
[root@EMA-PoC-Nexus home]# cat nexuspoc.mea-emigrate.com.csr
-----BEGIN CERTIFICATE REQUEST-----
MIICzjCCAbYCAQAwgYgxCzAJBgNVBAYTAklOMQ4wDAYDVQQIDAVEZWxoaTEOMAwG
A1UEBwwFRGVsaGkxDzANBgNVBAoMBnRyaWd5bjELMAkGA1UECwwCSVQxGzAZBgNV
BAMMEioubWVhLWVtaWdyYXRlLmNvbTEeMBwGCSqGSIb3DQEJARYPc3ltY0B0cmln
eW4uY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAomH8rtANZ53z
+hdWOGW40Qc+jQugMwmVp9Ywcfuc7B01CVIt6J9+8UWxTzcl7Zc89Phj4ln2pISg
CHftSbdjXaWq5Tq89WGClNLUc3o8Q104Z4dmUGk8Cy+k1n1n0R/jLqsZYsUiEqU0
Y7hApnqXQBY/WP9hDQFJ3jIqWUxqCC9UEnQm5aZUpf0++DzzMDERMv9QzZzr4lIz
czqvCx9j/cYSzXPqPFlaBQdiwp96NzVS8YN+IzgAdx50PHAq395AG+pVKBAXWEPl
u2lt+1Zl4us2Sk2wKJQVvbtOez7XXl46RoFFV55gisSsz99CUTM+e6DUv2muxa0J
PcIV+xKqpQIDAQABoAAwDQYJKoZIhvcNAQELBQADggEBAHxFUeezitKjFx8iro26
Fjd7BbgTRiofbxeKI711kGy5PctK39kUf68OhGVFMAQ4Huoz+PBJahT8aF50CQlJ
I9i0JtdNTUARPx6G5l0yxy0Y5TW2a+s+PbO/5bvmE1YBtWSdzC2d3u4ZBt+cf1DZ
exgOWOmYxxXCSQvORysoMMX/dp+NgcWIhzxcJh6oqb4C6wgbEJnsEY7OIoZfFqTZ
zku/O4yjGl7P2txGUrrclm1C4TreK9ng8KSlqyqqiLF4ujUy2qC9OS4b4+0twS/5
xeyoMs6WTWHAb7YS8wulWrQCj8cs152GoDN9x+BfBHVHgiS/pP/oJRqC09GvT6Ax
px4=
-----END CERTIFICATE REQUEST-----



























apiVersion: apps/v1
kind: Deployment
metadata:
  name:  administrationservice
  labels:
    app: administrationservice
  namespace: emigrate-dev-ns
spec:
  replicas: 1 # Set the number of desired replicas
  selector:
    matchLabels:
      app: administrationservice
  template:
    metadata:
      labels:
        app: administrationservice
    spec:
      containers:
      - name:  administrationservice
        image: nexuspoc.mea-emigrate.com/administrationservice:latest
        imagePullPolicy: Always
        ports:
        - containerPort: 8080  # Set the container port
        # volumeMounts:
        # - name: data-volume
        #   mountPath: "${mountpath}"
        # - name: data-volumeb
        #   mountPath: "${mountpath1}"
        resources:
          limits:
            cpu: 1000m
            memory: 1G
          requests:
            cpu: 500m
            memory: 500Mi
      # volumes:
      # - name: data-volume
      #   hostPath:
      #     path: "${hostpath}"
      # - name: data-volumeb
      #   hostPath:
      #     path: "${hostpath1}"
      imagePullSecrets:
        - name: nexuspoc

